generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Usuario {
  cpf           String   @id @db.VarChar(11)
  nome          String   @db.VarChar(100)
  email         String   @unique @db.VarChar(100)
  senha         String   @db.VarChar(255)
  dataCadastro  DateTime @default(now()) @map("data_cadastro")

  funcionario   Funcionario?
  tutor         Tutor?

  @@map("usuario")
}

model Clinica {
  cnpj              String               @id @db.VarChar(14)
  nome              String               @db.VarChar(100)
  endereco          String?              @db.VarChar(200)
  telefone          String?              @db.VarChar(20)
  email             String?              @db.VarChar(100)
  dataCadastro      DateTime             @default(now()) @map("data_cadastro")
  administradorCpf  String?              @map("administrador_cpf") @db.VarChar(11)
  
  administrador     Funcionario?         @relation("ClinicaAdministrador", fields: [administradorCpf], references: [cpf])
  funcionarios      FuncionarioClinica[]
  tutores           TutorClinica[]
  
  @@map("clinica")
}

model Funcionario {
  cpf                   String              @id @db.VarChar(11)
  cargo                 String              @db.VarChar(50)
  registroProfissional  String?             @map("registro_profissional") @db.VarChar(50)
  status                String              @default("ativo") @db.VarChar(20)
  nivelAcesso           Int                 @default(1) @map("nivel_acesso")
  
  usuario               Usuario             @relation(fields: [cpf], references: [cpf], onDelete: Cascade)
  clinicasAdministradas Clinica[]           @relation("ClinicaAdministrador")
  clinicas              FuncionarioClinica[]
  
  @@map("funcionario")
}

model Tutor {
  cpf       String         @id @db.VarChar(11)
  telefone  String?        @db.VarChar(20)
  endereco  String?         @db.VarChar(200)
  
  usuario   Usuario        @relation(fields: [cpf], references: [cpf], onDelete: Cascade)
  clinicas  TutorClinica[]
  
  @@map("tutor")
}

model FuncionarioClinica {
  funcionarioCpf  String      @map("funcionario_cpf") @db.VarChar(11)
  clinicaCnpj     String      @map("clinica_cnpj") @db.VarChar(14)
  
  funcionario     Funcionario @relation(fields: [funcionarioCpf], references: [cpf], onDelete: Cascade)
  clinica         Clinica     @relation(fields: [clinicaCnpj], references: [cnpj], onDelete: Cascade)
  
  @@id([funcionarioCpf, clinicaCnpj])
  @@map("funcionario_clinica")
}

model TutorClinica {
  tutorCpf    String   @map("tutor_cpf") @db.VarChar(11)
  clinicaCnpj String   @map("clinica_cnpj") @db.VarChar(14)
  
  tutor       Tutor    @relation(fields: [tutorCpf], references: [cpf], onDelete: Cascade)
  clinica     Clinica  @relation(fields: [clinicaCnpj], references: [cnpj], onDelete: Cascade)
  
  @@id([tutorCpf, clinicaCnpj])
  @@map("tutor_clinica")
}

